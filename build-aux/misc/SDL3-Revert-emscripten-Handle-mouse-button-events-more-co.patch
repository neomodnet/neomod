From e27570f6939bc18bd8ac97e5f6f028880f570e2c Mon Sep 17 00:00:00 2001
From: William Horvath <william@horvath.blog>
Date: Sun, 15 Feb 2026 10:01:52 -0800
Subject: [PATCH] Revert "emscripten: Handle mouse button events more
 correctly."

This reverts commit 25e33948af3b8e8df6e7bee753b72d745f669acd.
---
 src/video/emscripten/SDL_emscriptenevents.c | 16 +++++++---------
 1 file changed, 7 insertions(+), 9 deletions(-)

diff --git a/src/video/emscripten/SDL_emscriptenevents.c b/src/video/emscripten/SDL_emscriptenevents.c
index 4d91b7904..212b4dc6a 100644
--- a/src/video/emscripten/SDL_emscriptenevents.c
+++ b/src/video/emscripten/SDL_emscriptenevents.c
@@ -651,7 +651,6 @@ typedef struct Emscripten_PointerEvent
     int pointerid;
     int button;
     int buttons;
-    int down;
     float movementX;
     float movementY;
     float targetX;
@@ -666,14 +665,14 @@ typedef struct Emscripten_PointerEvent
 static void Emscripten_HandleMouseButton(SDL_WindowData *window_data, const Emscripten_PointerEvent *event)
 {
     Uint8 sdl_button;
-    const bool down = (event->down != 0);
+    bool down;
     switch (event->button) {
-        #define CHECK_MOUSE_BUTTON(jsbutton, sdlbutton) case jsbutton: sdl_button = SDL_BUTTON_##sdlbutton; break
-        CHECK_MOUSE_BUTTON(0, LEFT);
-        CHECK_MOUSE_BUTTON(1, MIDDLE);
-        CHECK_MOUSE_BUTTON(2, RIGHT);
-        CHECK_MOUSE_BUTTON(3, X1);
-        CHECK_MOUSE_BUTTON(4, X2);
+        #define CHECK_MOUSE_BUTTON(jsbutton, downflag, sdlbutton) case jsbutton: down = (event->buttons & downflag) != 0; ; sdl_button = SDL_BUTTON_##sdlbutton; break
+        CHECK_MOUSE_BUTTON(0, 1, LEFT);
+        CHECK_MOUSE_BUTTON(1, 4, MIDDLE);
+        CHECK_MOUSE_BUTTON(2, 2, RIGHT);
+        CHECK_MOUSE_BUTTON(3, 8, X1);
+        CHECK_MOUSE_BUTTON(4, 16, X2);
         #undef CHECK_MOUSE_BUTTON
         default: sdl_button = 0; break;
     }
@@ -979,7 +978,6 @@ static void Emscripten_prep_pointer_event_callbacks(void)
                     HEAP32[idx++] = event.pointerId;
                     HEAP32[idx++] = (typeof(event.button) !== "undefined") ? event.button : -1;
                     HEAP32[idx++] = event.buttons;
-                    HEAP32[idx++] = (event.type == "pointerdown") ? 1 : 0;
                     HEAPF32[idx++] = event.movementX;
                     HEAPF32[idx++] = event.movementY;
                     HEAPF32[idx++] = event.clientX - left;
-- 
2.53.0

